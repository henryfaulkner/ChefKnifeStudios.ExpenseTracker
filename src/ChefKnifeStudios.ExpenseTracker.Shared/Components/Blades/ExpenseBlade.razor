@using ChefKnifeStudios.ExpenseTracker.Shared.DTOs

<div class="expense-blade">
    <BladeContainer @ref="_bladeContainer">
        <ContentFragment>
            @if (_isLoading)
            {
                <div class="expense-blade__overlay">
                    <MatProgressCircle Indeterminate="true" Size="MatProgressCircleSize.Large" />
                </div>
            }

            <MatH4 class="clr-on-1t-container">
                Expense
            </MatH4>

            <div class="blade-content">
                <div class="form">
                    <MatTextField 
                        @bind-Value="@_name" 
                        Label="Choose a Name" 
                        Icon="create" 
                        Required="true" 
                        Disabled="_isLoading"
                    />

                    <MatTextField 
                        @bind-Value="@_cost" 
                        Label="Apply a Cost" 
                        Icon="attach_money"
                        Required="true"
                        Disabled="_isLoading" 
                    />

                    <span class="tooltip-container">
                        <div class="target" style="display: flex; align-items: center; justify-content: start;">
                            <MatCheckbox
                                @bind-Value="@_isRecurring"
                            >
                                <span class="is-recurring-label">
                                    Recurring expense? 
                                </span>
                            </MatCheckbox>
                            <button 
                                style="height: 20px;"
                                @onclick="HandleRecurringHelpPressed"
                                id="@_recurringHelpUid"
                            >
                                <MatIcon 
                                    Icon="help_outline"
                                    Class="clr-1s is-recurring-help-icon"
                                />
                            </button>
                        </div>
                        @if (_isRecurringTooltipOpen)
                        {
                            <span class="custom-tooltip">
                                This expense will be automatically generated once per month going forward.<span class="tooltip-arrow"></span>
                            </span>
                        }
                    </span>

                    <CategoryPicker />

                    <MatButton 
                        OnClick="HandleSubmitPressedAsync"
                        Unelevated="true"
                        Label="SUBMIT"
                        Disabled="@(_isLoading || ExpenseViewModel.IsListening)" 
                    />
                </div>

                <div class="btns">
                    <MatButton 
                        OnClick="@HandlePickPictureAsync"
                        Outlined="true"
                        Label="PICK PHOTO"
                        Icon="insert_photo" 
                        Disabled="@(_isLoading || ExpenseViewModel.IsListening)"
                    />

                    <MatButton
                        OnClick="@HandleTakePictureAsync"
                        Outlined="true"
                        Label="CAPTURE PHOTO"
                        Icon="add_a_photo"
                        Disabled="@(_isLoading || ExpenseViewModel.IsListening)" 
                    />

                    <MatDivider />

                    @if (!ExpenseViewModel.IsListening)
                    {
                        <MatButton
                            OnClick="@HandleStartListeningAsync"
                            Outlined="true"
                            Label="TELL ME"
                            Icon="mic"
                            Disabled="_isLoading" 
                        />
                    }
                    else
                    {
                        <MatButton
                            OnClick="@HandleStopListeningAsync"
                            Outlined="true"
                            Label="STOP LISTENING"
                            Icon="mic_off"
                            Disabled="_isLoading" 
                        />
                    }
                </div>
            </div>
        </ContentFragment>
    </BladeContainer>
</div>